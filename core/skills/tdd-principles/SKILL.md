---
name: tdd-principles
description: テスト駆動開発（TDD）の普遍的原則。全プラットフォーム・全言語共通で適用される考え方。
---

# TDD原則（普遍原則）

テスト駆動開発の普遍的な考え方と実践方法。
**具体的なツール・フレームワークは各ドメイン固有スキルを参照。**

---

## TDDサイクル

```
Red → Green → Refactor
 ↑__________________|
```

### 1. Red（失敗するテストを書く）
- 実装前にテストを書く
- テストが失敗することを確認する
- 「何を実現したいか」を先に定義する

### 2. Green（テストを通す最小限の実装）
- テストを通すことだけに集中する
- 過剰設計しない
- 動くコードを最優先

### 3. Refactor（リファクタリング）
- テストが通った状態でリファクタリング
- 重複を排除
- 可読性を向上

---

## テストの原則

### FIRST原則

| 原則 | 説明 |
|------|------|
| **F**ast | テストは高速に実行できる |
| **I**ndependent | テスト間に依存がない |
| **R**epeatable | 何度実行しても同じ結果 |
| **S**elf-validating | 成功/失敗が自動判定される |
| **T**imely | 実装前または実装と同時に書く |

### Arrange-Act-Assert (AAA)

```
// Arrange（準備）
const user = createTestUser();

// Act（実行）
const result = user.updateName("New Name");

// Assert（検証）
expect(result.name).toBe("New Name");
```

---

## テストの種類

| 種類 | 目的 | 特徴 |
|------|------|------|
| **Unit** | 単一関数/クラスの動作 | 高速、大量に書く |
| **Integration** | コンポーネント間連携 | 中速、重要な結合点 |
| **E2E** | ユーザー視点での動作 | 低速、重要なフローのみ |

### テストピラミッド

```
       /\
      /  \     E2E（少数）
     /----\
    /      \   Integration（中程度）
   /--------\
  /          \  Unit（多数）
 /____________\
```

---

## モック・スタブの使い方

### 使うべき場面
- 外部API（ネットワーク）
- データベース
- 時間依存（現在時刻）
- ランダム値

### 使うべきでない場面
- 自分が書いたコード（基本的に）
- テスト対象の内部実装

---

## 良いテストの特徴

1. **意図が明確**: テスト名だけで何をテストしているかわかる
2. **失敗理由が明確**: アサーションメッセージが具体的
3. **独立している**: 他のテストに依存しない
4. **保守しやすい**: 実装変更時にテスト変更が最小限

---

## アンチパターン

| パターン | 問題 |
|---------|------|
| テスト内で複数のassert | 何が失敗したかわかりにくい |
| 実装詳細をテスト | リファクタリングでテストが壊れる |
| テストデータの共有 | テスト間の依存が生まれる |
| 非決定的テスト | 環境依存で結果が変わる |

---

## 次のステップ

プラットフォーム固有のTDD実践は以下を参照:
- `domains/mobile/common/skills/mobile-tdd` - モバイル向けTDD
- `domains/mobile/flutter/skills/flutter-tdd` - Flutter固有
