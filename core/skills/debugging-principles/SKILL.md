---
name: debugging-principles
description: デバッグの普遍的原則。全プラットフォーム・全言語共通で適用される考え方。
---

# デバッグ原則（普遍原則）

効果的なデバッグの考え方と実践方法。

---

## デバッグの基本姿勢

1. **再現性を確保**: まず問題を確実に再現できる状態にする
2. **仮説を立てる**: 闇雲に試さない、仮説→検証のサイクル
3. **分割統治**: 問題範囲を半分ずつ絞り込む
4. **記録を残す**: 試したこと、結果を記録する

---

## デバッグフロー

```
1. 問題の観察
   ↓
2. 再現手順の確立
   ↓
3. 仮説の形成
   ↓
4. 仮説の検証
   ↓
5. 原因の特定
   ↓
6. 修正
   ↓
7. 修正の検証
   ↓
8. 回帰テスト追加
```

---

## 問題切り分けテクニック

### 二分探索（Binary Search）

```
問題が起きるコード範囲を半分に分ける
 ↓
前半で問題発生？ → 前半をさらに二分
 ↓
後半で問題発生？ → 後半をさらに二分
 ↓
原因特定
```

### 最小再現コード

- 問題を再現する最小限のコードを作成
- 不要な部分を削ぎ落とす
- 本質的な原因が見えてくる

---

## よくある原因パターン

| カテゴリ | 例 |
|---------|-----|
| **状態** | 初期化漏れ、状態の不整合 |
| **タイミング** | 非同期処理の順序、レースコンディション |
| **境界** | オフバイワン、null/undefined |
| **環境** | 環境変数、設定ファイル、依存バージョン |
| **キャッシュ** | 古いキャッシュ、ビルドキャッシュ |

---

## デバッグ時のチェックリスト

### 基本確認
- [ ] エラーメッセージを正確に読んだか
- [ ] スタックトレースを確認したか
- [ ] 最近の変更点を確認したか

### 環境確認
- [ ] 開発環境と本番環境の差異は？
- [ ] 依存パッケージのバージョンは？
- [ ] キャッシュをクリアしたか

### 状態確認
- [ ] 入力値は想定通りか
- [ ] 中間状態は想定通りか
- [ ] 出力値は何が違うか

---

## デバッグのアンチパターン

| パターン | 問題 |
|---------|------|
| **printf デバッグの乱用** | 構造的でない、消し忘れ |
| **試行錯誤の繰り返し** | 仮説なしに変更を当てずっぽう |
| **複数変更の同時適用** | どの変更が効いたかわからない |
| **根本原因放置** | 症状だけ対処して再発 |

---

## ログの活用

### 良いログ

```
[INFO] User login: userId=123, method=oauth, timestamp=2026-02-07T12:00:00Z
[ERROR] Payment failed: orderId=456, reason=insufficient_funds, amount=1000
```

### 悪いログ

```
[INFO] Processing...
[ERROR] Error occurred
```

---

## 助けを求めるタイミング

以下の場合は他者に相談:
- 同じ問題に30分以上費やしている
- 仮説が尽きた
- 再現できない
- 環境固有の問題の可能性

---

## 修正後の確認

1. **問題が解決したか**: 元の問題が再現しないこと
2. **副作用がないか**: 他の機能に影響がないこと
3. **テストを追加**: 回帰防止のテストを書く
4. **原因を記録**: 将来の参考のために記録
